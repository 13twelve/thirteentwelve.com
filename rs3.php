<!DOCTYPE html>
<html dir="ltr" lang="en-UK">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RS3</title>
    <link href="/stylesheets/application.css" rel="stylesheet" />
    <link rel="shortcut icon" href="/images/rs3/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/rs3/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/images/rs3/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/images/rs3/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/images/rs3/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/images/rs3/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/images/rs3/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/images/rs3/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/images/rs3/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/rs3/apple-touch-icon-180x180.png" />
  </head>
  <body>
    <div id="thirteentwelve">
      <header>
        <span class="logo">
          <svg class="logo__audi" viewbox="0 0 122.88 42.64"><path d="M20.76,4.44C16.22,4.59,12.14,6.53,9.2,9.57c-2.94,3.04-4.74,7.18-4.74,11.74c0,4.66,1.89,8.88,4.94,11.93 c3.05,3.05,7.27,4.94,11.93,4.94c3.83,0,7.36-1.27,10.19-3.42c-2.99-3.67-4.78-8.35-4.78-13.45c0-5.09,1.79-9.78,4.78-13.45 c-2.69-2.04-6.01-3.3-9.63-3.42L20.76,4.44L20.76,4.44z M6,6.49C9.72,2.65,14.87,0.19,20.62,0l1.41,0c4.8,0.16,9.18,1.9,12.66,4.7 c3.48-2.8,7.87-4.54,12.66-4.7l1.41,0c4.8,0.16,9.18,1.9,12.66,4.7C64.92,1.9,69.31,0.16,74.1,0l1.41,0 c4.8,0.16,9.18,1.9,12.66,4.7c3.48-2.8,7.87-4.54,12.66-4.7l1.41,0c5.75,0.19,10.91,2.65,14.62,6.49c3.72,3.84,6,9.07,6,14.82 c0,5.89-2.39,11.22-6.25,15.08c-3.86,3.86-9.19,6.25-15.08,6.25c-5.06,0-9.71-1.76-13.37-4.71c-3.66,2.95-8.31,4.71-13.37,4.71 c-5.06,0-9.71-1.76-13.37-4.71c-3.66,2.95-8.31,4.71-13.37,4.71s-9.71-1.76-13.37-4.71c-3.66,2.95-8.31,4.71-13.37,4.71 c-5.89,0-11.22-2.39-15.08-6.25C2.39,32.53,0,27.2,0,21.31C0,15.56,2.28,10.33,6,6.49L6,6.49z M34.7,31.6 c2.2-2.85,3.5-6.42,3.5-10.29c0-3.87-1.3-7.45-3.5-10.3c-2.2,2.85-3.5,6.43-3.5,10.3C31.2,25.18,32.5,28.75,34.7,31.6L34.7,31.6z M42.66,21.31c0,5.1-1.79,9.78-4.78,13.45c2.83,2.15,6.36,3.42,10.19,3.42c3.83,0,7.36-1.27,10.19-3.42 c-2.99-3.67-4.78-8.35-4.78-13.45c0-5.09,1.79-9.78,4.78-13.45c-2.69-2.04-6.01-3.3-9.63-3.42l-1.14,0 c-3.62,0.12-6.94,1.38-9.63,3.42C40.87,11.53,42.66,16.22,42.66,21.31L42.66,21.31z M61.44,31.6c2.19-2.85,3.5-6.42,3.5-10.29 c0-3.87-1.3-7.45-3.5-10.3c-2.2,2.85-3.5,6.43-3.5,10.3C57.94,25.18,59.24,28.75,61.44,31.6L61.44,31.6z M69.4,21.31 c0,5.1-1.79,9.78-4.78,13.45c2.83,2.15,6.36,3.42,10.19,3.42c3.83,0,7.36-1.27,10.19-3.42c-2.99-3.67-4.78-8.35-4.78-13.45 c0-5.09,1.79-9.78,4.78-13.45c-2.69-2.04-6.01-3.3-9.63-3.42l-1.14,0c-3.62,0.12-6.94,1.38-9.63,3.42 C67.61,11.53,69.4,16.22,69.4,21.31L69.4,21.31z M88.18,31.6c2.2-2.85,3.5-6.42,3.5-10.29c0-3.87-1.3-7.45-3.5-10.3 c-2.2,2.85-3.5,6.43-3.5,10.3C84.68,25.18,85.99,28.75,88.18,31.6L88.18,31.6z M96.14,21.31c0,5.1-1.79,9.78-4.78,13.45 c2.83,2.15,6.36,3.42,10.19,3.42c4.66,0,8.88-1.89,11.93-4.94c3.05-3.05,4.94-7.27,4.94-11.93c0-4.55-1.8-8.7-4.75-11.74 s-7.02-4.98-11.56-5.13l-1.14,0c-3.62,0.12-6.94,1.38-9.63,3.42C94.35,11.53,96.14,16.22,96.14,21.31L96.14,21.31z"/></svg>
        </span>
      </header>
      <main id="content">
        <section id="lease-miles-calculator">
          <dl>
            <dt>Odometer:</dt>
            <dd>
              <input id="odometer" type="text" value="0" pattern="[0-9]"> miles
            </dd>
          </dl>

          <p>
            <button id="calculate">Calculate</button>
          </p>

          <dl>
            <dt>Miles driven</dt>
            <dd id="milesDriven"></dd>
            <dt>Target miles to date:</dt>
            <dd id="targetMilesToDate"></dd>
            <dt>Diff. from target:</dt>
            <dd id="milesDiff"></dd>
          </dl>

          <div class="bars">
            <div class="bars__bar bars__bar--target" id="barMilesTarget" title="target"></div>
            <div class="bars__bar bars__bar--driven" id="barodometer" title="driven"></div>
            <i class="bars__label-total-miles" id="labelTotalMiles"></i>
          </div>

          <div class="cols">
            <dl class="col">
              <dt>Date Start (d/m/y):</dt>
              <dd>
                <input id="dateStart_day" type="text" value="31" pattern="[0-9]">
                <input id="dateStart_month" type="text" value="10" pattern="[0-9]">
                <input id="dateStart_year" type="text" value="2018" pattern="[0-9]">
              </dd>
            </dl>
            <dl class="col">
              <dt>Start miles:</dt>
              <dd>
                <input id="startMiles" type="text" value="0" pattern="[0-9]"> miles
              </dd>
              <dt>Insured miles:</dt>
              <dd>
                <input id="insuredMiles" type="text" value="9000" pattern="[0-9]"> miles
              </dd>
            </dl>
          </div>

          <div class="cols">
            <dl class="col">
              <dt>Date today:</dt>
              <dd id="dateToday"></dd>
              <dt>Date end (at midnight):</dt>
              <dd id="dateEnd"></dd>
              <dt>Days into policy:</dt>
              <dd id="daysIntoLease"></dd>
              <dt>Total days of policy:</dt>
              <dd id="totalDays"></dd>
              <dt>Total miles allowed:</dt>
              <dd id="totalMiles"></dd>
              <dt>Policy miles available per day:</dt>
              <dd id="leaseMilesPerDay"></dd>
              <dt>Policy miles available per week:</dt>
              <dd id="leaseMilesPerWeek"></dd>
            </dl>
            <dl class="col">
              <dt>% diff:</dt>
              <dd id="milesDiffPercent"></dd>
              <dt>Miles remaining total:</dt>
              <dd id="milesRemaining"></dd>
              <dt>Adjusted miles available per day:</dt>
              <dd id="milesRemainingPerDay"></dd>
              <dt>Adjusted miles available per week:</dt>
              <dd id="milesRemainingPerWeek"></dd>
            </dl>
          </div>
        </section>

        <script>
          var nameSpace = 'rs3';
          var oneDay = 24 * 60 * 60 * 1000;
          var oneWeek = oneDay * 7;
          var monthNames = [
            "January", "February", "March",
            "April", "May", "June", "July",
            "August", "September", "October",
            "November", "December"
          ];
          var locked = false;

          if (typeof(Storage) !== "undefined") {
            document.getElementById("startMiles").value = parseInt(localStorage.getItem(nameSpace+"_ins_startMiles", startMiles)) || 46588;
            document.getElementById("odometer").value = parseInt(localStorage.getItem(nameSpace+"_ins_odometer", odometer)) || 46588;
            document.getElementById("dateStart_day").value = parseInt(localStorage.getItem(nameSpace+"_ins_dateStart_day",dateStart_day)) || 13;
            document.getElementById("dateStart_month").value = (parseInt(localStorage.getItem(nameSpace+"_ins_dateStart_month", dateStart_month)) + 1) || 1;
            document.getElementById("dateStart_year").value = parseInt(localStorage.getItem(nameSpace+"_ins_dateStart_year", dateStart_year)) || 2024;
            document.getElementById("insuredMiles").value = parseInt(localStorage.getItem(nameSpace+"_ins_insuredMiles", insuredMiles)) || 10000;
          }

          function update(event) {
            if (locked) {
              return;
            }
            if (event) {
              locked = true;
              var that = this;
              that.blur();
              that.classList.add('js-loading');
              setTimeout(function(){
                that.classList.remove('js-loading');
                locked = false;
              },500);
            }
            try {
              var startMiles = parseInt(document.getElementById("startMiles").value);
              var odometer = parseInt(document.getElementById("odometer").value);
              var dateStart_day = parseInt(document.getElementById("dateStart_day").value);
              var dateStart_month = parseInt(document.getElementById("dateStart_month").value) - 1;
              var dateStart_year = parseInt(document.getElementById("dateStart_year").value);
              var insuredMiles = parseInt(document.getElementById("insuredMiles").value);

              if (typeof(Storage) !== "undefined") {
                localStorage.setItem(nameSpace+"_ins_startMiles", startMiles);
                localStorage.setItem(nameSpace+"_ins_odometer", odometer);
                localStorage.setItem(nameSpace+"_ins_dateStart_day",dateStart_day);
                localStorage.setItem(nameSpace+"_ins_dateStart_month", dateStart_month);
                localStorage.setItem(nameSpace+"_ins_dateStart_year", dateStart_year);
                localStorage.setItem(nameSpace+"_ins_insuredMiles", insuredMiles);
              }

              var dateStart = new Date(dateStart_year, dateStart_month, dateStart_day);
              var dateEnd = new Date(new Date(dateStart).setMonth(dateStart.getMonth()+12));
              dateEnd = new Date(dateEnd.setDate(dateEnd.getDate()-1));
              var totalMiles = insuredMiles;
              var totalDays = Math.round(Math.abs((dateStart.getTime() - dateEnd.getTime())/(oneDay)));
              var dateToday = new Date();
              dateToday = new Date(dateToday.setHours(0,0,0,0));
              var daysIntoLease = Math.round(Math.abs((dateStart.getTime() - dateToday.getTime())/(oneDay)));
              var milesDriven = odometer - startMiles;
              var leaseMilesPerDay = totalMiles / totalDays;
              var leaseMilesPerWeek = leaseMilesPerDay * 7;
              var targetMilesToDate = leaseMilesPerDay * daysIntoLease;
              var targetMilesToDatePercentageOfTotal = (targetMilesToDate * 100) / totalMiles;
              odometer = odometer - startMiles;
              var milesDiff = odometer - targetMilesToDate;
              var milesDiffPercent = (milesDiff * 100)/targetMilesToDate;
              var milesRemaining = totalMiles - odometer;
              var odometerPercentageOfTotal = (odometer * 100) / totalMiles;
              var milesRemainingPerDay = milesRemaining / (totalDays - daysIntoLease);
              var milesRemainingPerWeek = milesRemainingPerDay * 7;

              document.getElementById("dateEnd").textContent = dateEnd.getDate() + " " + monthNames[dateEnd.getMonth()] + " " + dateEnd.getFullYear();
              document.getElementById("milesDriven").textContent = milesDriven;
              document.getElementById("totalMiles").textContent = totalMiles;
              document.getElementById("totalDays").textContent = totalDays;
              document.getElementById("dateToday").textContent = dateToday.getDate() + " " + monthNames[dateToday.getMonth()] + " " + dateToday.getFullYear();
              document.getElementById("daysIntoLease").textContent = daysIntoLease;
              document.getElementById("leaseMilesPerDay").textContent = Math.floor(leaseMilesPerDay);
              document.getElementById("leaseMilesPerWeek").textContent = Math.floor(leaseMilesPerWeek);
              document.getElementById("targetMilesToDate").textContent = Math.floor(targetMilesToDate);
              document.getElementById("milesDiff").textContent = Math.round(milesDiff);
              document.getElementById("milesDiffPercent").textContent = Math.round(milesDiffPercent) + "%";
              document.getElementById("milesRemaining").textContent = Math.round(milesRemaining);
              document.getElementById("milesRemainingPerDay").textContent = Math.round(milesRemainingPerDay);
              document.getElementById("milesRemainingPerWeek").textContent = Math.round(milesRemainingPerWeek);
              document.getElementById("labelTotalMiles").textContent = totalMiles;

              if (event) {
                setTimeout(function(){
                  document.getElementById("barMilesTarget").style.width = targetMilesToDatePercentageOfTotal + "%";
                  document.getElementById("barodometer").style.width = odometerPercentageOfTotal + "%";
                },500);
              } else {
                document.getElementById("barMilesTarget").style.width = targetMilesToDatePercentageOfTotal + "%";
                document.getElementById("barodometer").style.width = odometerPercentageOfTotal + "%";
              }

              if (milesDiff > 0) {
                document.getElementById("milesDiff").className = "too-many";
                document.getElementById("barMilesTarget").style.zIndex = 2;
              } else {
                document.getElementById("milesDiff").className = "too-few";
                document.getElementById("barMilesTarget").style.zIndex = "initial";
              }
            } catch(err) {
              alert("Did you put numbers in the start date, miles per annum and miles driven?");
            }
          }

          document.getElementById("calculate").addEventListener("click",update);

          update();
        </script>
      </main>
    </div>
  </body>
</html>
